<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="search" type="application/opensearchdescription+xml" title="WANdisco docs" href="/wandisco-documentation/opensearch.xml"><title data-react-helmet="true">Kerberos (HDP) integration with Fusion | WANdisco docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Kerberos (HDP) integration with Fusion | WANdisco docs"><meta data-react-helmet="true" name="description" content="[//]:"><meta data-react-helmet="true" property="og:description" content="[//]:"><meta data-react-helmet="true" property="og:url" content="https://wandisco.github.io/wandisco-documentation//wandisco-documentation/docs/quickstarts/kerberos_hdp"><link data-react-helmet="true" rel="shortcut icon" href="/wandisco-documentation/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://wandisco.github.io/wandisco-documentation//wandisco-documentation/docs/quickstarts/kerberos_hdp"><link rel="stylesheet" href="/wandisco-documentation/styles.a9227a34.css">
<link rel="preload" href="/wandisco-documentation/styles.6c749758.js" as="script">
<link rel="preload" href="/wandisco-documentation/runtime~main.f21f7e0f.js" as="script">
<link rel="preload" href="/wandisco-documentation/main.a3cad2da.js" as="script">
<link rel="preload" href="/wandisco-documentation/1.2d25f03f.js" as="script">
<link rel="preload" href="/wandisco-documentation/2.b83af041.js" as="script">
<link rel="preload" href="/wandisco-documentation/3.73e74ddd.js" as="script">
<link rel="preload" href="/wandisco-documentation/1be78505.a01211c2.js" as="script">
<link rel="preload" href="/wandisco-documentation/113.cffd459e.js" as="script">
<link rel="preload" href="/wandisco-documentation/ae4b7282.81cbb644.js" as="script">
<link rel="preload" href="/wandisco-documentation/17896441.acb2b8c3.js" as="script">
<link rel="preload" href="/wandisco-documentation/d6a58866.b677835f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/wandisco-documentation/"><img class="navbar__logo" src="/wandisco-documentation/img/favicon.png" alt="WANdisco Fusion Logo"><strong class="navbar__title">WANdisco Fusion</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/wandisco-documentation/docs/why-fusion/benefits">Why Fusion?</a><a class="navbar__item navbar__link" href="/wandisco-documentation/docs/quickstarts/installation/quickstart-config">Quickstarts</a><a class="navbar__item navbar__link" href="/wandisco-documentation/docs/docs/doc1">Docs</a><a class="navbar__item navbar__link" href="/wandisco-documentation/docs/glossary/a">Glossary</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/wandisco-documentation/"><img class="navbar__logo" src="/wandisco-documentation/img/favicon.png" alt="WANdisco Fusion Logo"><strong class="navbar__title">WANdisco Fusion</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/wandisco-documentation/docs/why-fusion/benefits">Why Fusion?</a></li><li class="menu__list-item"><a class="menu__link" href="/wandisco-documentation/docs/quickstarts/installation/quickstart-config">Quickstarts</a></li><li class="menu__list-item"><a class="menu__link" href="/wandisco-documentation/docs/docs/doc1">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/wandisco-documentation/docs/glossary/a">Glossary</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Kerberos (HDP) integration with Fusion</h1></header><div class="markdown"><p><em>THIS GUIDE IS WORK IN PROGRESS, PLEASE DO NOT FOLLOW ANYTHING HERE UNTIL THIS WARNING IS REMOVED</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="introduction"></a>Introduction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>This guide should be followed when you want to enable your Fusion installation to work with a Kerberized Hortonworks (HDP) cluster.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="prerequisites"></a>Prerequisites<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li><p>Fusion has been installed and configured with a HDP zone. See <a href="https://wandisco.github.io/wandisco-documentation/docs/quickstarts/installation/quickstart-config" target="_blank" rel="noopener noreferrer">Quickstart guidance</a> for relevant documentation on how to achieve this.</p></li><li><p>An <code>/etc/hosts</code> entry for the Docker hostname plus <code>fusion-server-hdp</code> on all nodes in the HDP cluster.</p><p><em>Example -</em> <code>172.0.0.4  docker_host01 fusion-server-hdp</code></p></li><li><p>KDC administrator credentials for the HDP cluster.</p></li><li><p>A Kerberos keytab and principal to be used with Fusion. The principal must map to a user that has superuser permissions. This is commonly done by using the HDFS keytab with Fusion.</p><hr><p>This could also be done by creating a keytab and principal for Fusion with either:</p><ul><li><p>An <a href="https://docs.cloudera.com/HDPDocuments/HDP3/HDP-3.1.4/security-reference/content/kerberos_nonambari_creating_mappings_between_principals_and_unix_usernames.html">auth_to_local</a> rule that maps the Fusion principal to a superuser.</p><p><em>Example rule</em> - <code>RULE:[1:$1@$0](fusionuser@WANDISCO.HADOOP)s/.*/hdfs/</code></p></li><li><p>An <a href="https://docs.cloudera.com/HDPDocuments/HDP3/HDP-3.1.4/security-reference/content/kerberos_nonambari_creating_mappings_between_principals_and_unix_usernames.html">auth_to_local</a> rule that maps the Fusion principal to a user that is added to the HDFS supergroup on the NameNodes.</p><p><em>Example rule</em> - <code>RULE:[1:$1@$0](fusionuser@WANDISCO.HADOOP)s/.*/fusionuser/</code></p><p><em>Example command on NameNodes</em> - <code>usermod fusionuser -G hdfs</code></p></li></ul><hr></li><li><p>The keytab to be used with Fusion should be stored in the <code>/etc/security/keytabs</code> directory on the Ambari Server.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="integrating-kerberos-with-fusion"></a>Integrating Kerberos with Fusion<a aria-hidden="true" tabindex="-1" class="hash-link" href="#integrating-kerberos-with-fusion" title="Direct link to heading">#</a></h2><p>This method will allow the Hadoop configuration and Kerberos keytabs to be shared with the Fusion installation, by inducting a specific container into the HDP cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="add-the-sshd-container-to-the-hdp-cluster"></a>Add the SSHD container to the HDP cluster<a aria-hidden="true" tabindex="-1" class="hash-link" href="#add-the-sshd-container-to-the-hdp-cluster" title="Direct link to heading">#</a></h3><ol><li><p>Log in to the Docker host, and switch to the fusion-docker-compose directory.</p><p><code>cd /path/to/fusion-docker-compose</code></p></li><li><p>Ensure the Fusion containers are running.</p><p><code>docker-compose ps</code></p></li><li><p>Run a command to obtain the private key of the SSHD container for the HDP zone.</p><p><code>docker logs fusion_sshd-hdp_1</code></p><p><em>Example output</em></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----BEGIN RSA PRIVATE KEY-----</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MIIEogIBAAKCAQEAuK38KexpwnOYE+hI0a+UXtgNoE1JVPp0n+/DOCTs9AKkpm8e</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">bwkVg/sErvRQ63l0gPc7YXiQClc7Ha11rUe1rTez8Hx0MmDcWEwiuFT3Hoonc3Sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WNqcua7R8+r+HOS5+CRHAx/25ogdPeygX+U+PyIutGHvHI4I37Z/tRwmakFlfLuF</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">jgcqjhuqfjY60hM90aoyL2AnGb5pfsEKo2hB8oEquNciuPJo5FHk+3NFpOWLMcwG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1OQpHjoBLNxZuuZP2C6KTQjodvuLIx/DaA33t2MIJQVKn0sL3wp2PP/ZD59CVqbV</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">XmaDoNG0jm0b+PYH97MBS2p2BCVGqskx7TvR6QIDAQABAoIBAB+HrNang0Lso1k6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">vjv2gxlSP7lPmKaGgCTSNX0/aKkcTmoP7J1+asr2r00Db1FUkhx2mSQNBmKNlA00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ETQ9Wvow2WrEhL4ZJWV50i+waeRv595hWi6mXD2jaDsBstLSBiIkZ29UJL4lHQD2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hkb5B5CV0G2BjuZMJZ20NceA/9oB+AALfo+X6wR610AkWXCDJOClJHbU6fa8fPAO</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pp+ucbsZ1EIuCpupV3lWZpDJw4Jw2aqDrIq7UX+hqfE38pePSBL6jLHiQACEyehU</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">lqbmSInZFuMSAjuVK/Ewp8nxsEAJ4gH4RJx6DcE0XnaGEO03b6aFDqktbv0jhKWS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">igJHGAECgYEA38KQxlbcxWPW1CclHlJG4tou8hDjPWZ4haEVujxsvrKpbVethxsM</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">4Q7VK4ePbIwnEAHjHZw48hsXCumk1ECo91N48L/YuxHWwuRMm9KozbxjyQUl2tjg</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">u8nCSXWWDj89VW+Z+Q8ye3DHr7m8JaarSafy5Pov+XSvmXUfIxLBQwECgYEA00nu</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">YGxZiTy2jhwL7V7QvUMqsFgc8AXnYcKLG1wXGJhUCVbzjFcKIofEnUiYIfDPl7uJ</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">S7tQiaeRkl9z7YuV1GH2vtu2WJL/zItG8uFy0CbvNsrsVXMxYFeegAwKijsonGR/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">K4ZCdrao8sIli+EHkmgUAYrzmgoDoFr4M5RT1ukCgYBNiMjLwUuMplTJfKry/8WK</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">U9oSjOGA5CH9A91YhBmWVqg4uDnr5+alkZMyGy4KieH7PPwqxXhCBDsOz/kKh0FF</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Okpc+c0qvTqym5MkJ3HQoGooPwZn9+CfkYDeHX2agDVLhnj2TFrMxT6cWHqmfUM7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">KZQT3dGD2fgC77+TUqtfAQKBgA3offKG71XjUzkDi51yclcjBrpY8n6yRMrgnXuN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kk+iJ1X+DUYdrKMdQMoBr1H8og2g4KbFi8Wj7CcwdVcbqx8x26YwnE40TvZN7Lus</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">L3yYM4Lt1KTDUmq/GcXgBQmYX1H8I4rf6Zwa5gAk24fbpj3y7+4yEVsAccCrie8L</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">QoGRAoGAHk/qaX1BTLOtjp6pc7TfYAUpPkhBHjT22eQOjdlUxfV6nbun/pN1/ZXP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">v1a+mgvGqUw24CP+2ZBcLICSk4dlSECy6tUyvLle7iEYMrMRZDyxVrxtFwG3NZKH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LYoIZTJyKjilWf2otcq/CXief6NA5yfQyK7b3MCYTA6kyV/KlyZ=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----END RSA PRIVATE KEY-----</span></div></div></div></div></div><p>Save this private key as a file (e.g. <code>hdp-key.pem</code>) or copy to clipboard to be used later.</p></li><li><p>Log in to the Ambari Server via a terminal session and confirm that the container is accessible via ssh.</p><p><code>ssh -i hdp-key.pem -p 2022 root@&lt;docker-hostname&gt;</code></p><p>Either copy the <code>hdp-key.pem</code> file over to the Ambari Server or create the file and paste in the contents of your clipboard. You can exit the container once SSH access is confirmed.</p><p>You may need to set permissions of the key to read only before using it.</p><p><em>Example</em></p><p><code>chown 400 hdp-key.pem</code></p></li><li><p>Log in to the Ambari UI and select to Add New Hosts.</p><p><strong>Ambari UI -&gt; Hosts -&gt; Actions -&gt; Add New Hosts</strong></p></li><li><p>In the Add Host Wizard, provide the following information:</p><ul><li>Target Hosts - Enter the docker hostname in this field.</li><li>Host Registration Information - Provide the contents of the private key file from the docker SSHD container (i.e. <code>hdp-key.pem</code>).</li><li>SSH Port Number - change the port number to <code>2022</code>.</li></ul><p>Click <strong>REGISTER AND CONFIRM</strong> when done.</p></li><li><p>Wait for the host checks are completed in the <strong>Confirm Hosts</strong> step.</p><p>There is a possibility that the Java version required will not be installed on the SSHD container. If so, then you will need to transfer the JDK to the SSHD container.</p><p><em>Example</em></p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# scp -i hdp-key.pem -P 2022 /usr/java/jdk1.8.0_XYZ.tar.gz &lt;SSHD_CONTAINER&gt;:~</code></p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# ssh -i hdp-key.pem -p 2022 &lt;SSHD_CONTAINER&gt;</code></p><p><code>[root@&lt;SSHD_CONTAINER&gt; ~]# mkdir -p /usr/java</code></p><p><code>[root@&lt;SSHD_CONTAINER&gt;&gt; ~]# tar -xf jdk1.8.0_XYZ.tar.gz -C /usr/java/</code></p><hr><p>Check that the JCE policy is set to unlimited strength (see the <a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=JDK-8170157">Oracle bug report</a> for further information), the output from the command below should read <code>true</code> if this is the case.</p><p><code>/usr/java/jdk1.8.0_XYZ/bin/jrunscript -e &#x27;print (javax.crypto.Cipher.getMaxAllowedKeyLength(&quot;RC5&quot;) &gt;= 256);&#x27;</code></p><p>If the command returns <code>false</code>, you may want to enable unlimited strength policies.</p><ul><li><p><strong>Java 8 Update 161 or higher</strong> - Edit the <code>java.security</code> file in <code>/usr/java/jdk1.8.0_XYZ/jre/lib/security</code> (for JDK) or <code>/usr/java/jdk1.8.0_XYZ/lib/security</code> (for JRE). Uncomment or include the line:</p><p><code>crypto.policy=unlimited</code></p></li><li><p><strong>Java 8 Update 160 or below</strong> - Download the unlimited strength JCE policy files from Oracle <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">here</a> and transfer the zip file to the SSHD container. Log in to the container afterwards.</p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# scp -i hdp-key.pem -P 2022 jce_policy-8.zip &lt;SSHD_CONTAINER&gt;:~</code></p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# ssh -i hdp-key.pem -p 2022 &lt;SSHD_CONTAINER&gt;</code></p><p><em>or</em></p><p><code>root@&lt;DOCKER_HOST&gt;:~# docker cp jce_policy-8.zip &lt;CONTAINER-ID_of_fusion_sshd-hdp_1&gt;:/root/</code></p><p><code>root@&lt;DOCKER_HOST&gt;:~# docker exec -it fusion_sshd-hdp_1 bash</code></p><p>Extract the policy files and replace the existing policy JAR files in <code>/usr/java/jdk1.8.0_XYZ/jre/lib/security</code> with the unlimited policy ones.</p><p><code>[root@&lt;SSHD_CONTAINER&gt;&gt; ~]# unzip jce_policy-8.zip</code></p><p><code>[root@&lt;SSHD_CONTAINER&gt;&gt; ~]# cp UnlimitedJCEPolicyJDK8/US_export_policy.jar /usr/java/jdk1.8.0_XYZ/jre/lib/security/</code></p><p><code>[root@&lt;SSHD_CONTAINER&gt;&gt; ~]# cp UnlimitedJCEPolicyJDK8/local_policy.jar /usr/java/jdk1.8.0_XYZ/jre/lib/security/</code></p><p>Select to overwrite the existing files when prompted.</p></li></ul><hr><p>Any warnings relating to the <code>/etc/hadoop</code> path should be ignored as the SSHD container will use symlinks to retain Hadoop configuration.</p><p>Click Next once complete.</p></li><li><p>On the <strong>Assign Slaves and Clients</strong> step, ensure that the Client option is selected for the Docker host. Click Next once confirmed.</p></li><li><p>On the <strong>Configurations</strong> step, unless a specific Configuration Group is required, leave the services on Default and click Next.</p></li><li><p>Click Deploy on the <strong>Review</strong> step.</p></li><li><p>If Kerberos is enabled on the cluster, enter your KDC administrator credentials on the pop-up window and click Save.</p></li><li><p>Wait until the <strong>Install, Start and Test</strong> procedure is complete, then click Next.</p></li><li><p>On the Summary page, click Complete.</p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configure-the-hdp-cluster"></a>Configure the HDP cluster<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configure-the-hdp-cluster" title="Direct link to heading">#</a></h3><ol><li><p>Transfer the Kerberos configuration file for the cluster into the SSHD container.</p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# scp -i hdp-key.pem -P 2022 /etc/krb5.conf &lt;SSHD_CONTAINER&gt;:/etc/shared/krb5.conf</code></p></li><li><p>If required, transfer the keytab to be used with Fusion to the SSHD container.</p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# scp -i hdp-key.pem -P 2022 /etc/security/keytabs/${FUSION_KEYTAB}.keytab &lt;SSHD_CONTAINER&gt;:/etc/security/keytabs/</code></p><p>This should not be required if using an auto-generated keytab (such as the <code>hdfs</code> keytab) within the <code>/etc/security/keytabs</code> directory, as it will have been mapped to the SSHD container automatically.</p></li><li><p>Create two directories within HDFS on the cluster that will be used specifically by Fusion (ensure to <code>kinit</code> beforehand).</p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# hdfs dfs -mkdir -p /wandisco/exchange_dir</code></p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# hdfs dfs -mkdir -p /wandisco/handshake_tokens</code></p><p>Ensure they are owned by the Fusion user, in the example below, the Fusion user will be <code>hdfs</code>.</p><p><code>[root@&lt;AMBARI_SERVER&gt; ~]# hdfs dfs -chown hdfs:hdfs -R /wandisco</code></p></li><li><p>Add Fusion properties to the HDFS config on the cluster.</p><p><strong>Ambari UI -&gt; HDFS -&gt; Configs -&gt; Advanced -&gt; Custom core-site</strong></p><p>Select to add the properties below in <strong>Bulk property add mode</strong>.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.client.ssl.enabled=false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.handshakeToken.dir=/wandisco/handshake_tokens</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.http.authentication.enabled=false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.http.authorization.enabled=false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.replicated.dir.exchange=/wandisco/exchange_dir</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.server=fusion-server-hdp:8023</span></div></div></div></div></div><p>Next, add the properties below but adjust the values (encased with <code>${}</code>) so that they are correct for your environment:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fs.fusion.underlyingFs=hdfs://${CLUSTER_NAMESERVICE} or hdfs://${NAMENODE}:${PORT}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.keytab=/etc/security/keytabs/${FUSION_KEYTAB}.keytab</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.principal=${FUSION_PRINCIPAL}@${REALM}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hadoop.proxyuser.${FUSION_USER}.hosts=fusion-server-hdp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hadoop.proxyuser.${FUSION_USER}.groups=*</span></div></div></div></div></div><p><em>Example</em></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fs.fusion.underlyingFs=hdfs://nameservice01</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.keytab=/etc/security/keytabs/hdfs.keytab</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fusion.principal=hdfs-hdp-01@$REALM.COM</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hadoop.proxyuser.hdfs.hosts=fusion-server-hdp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hadoop.proxyuser.hdfs.groups=*</span></div></div></div></div></div><p>If the <code>hadoop.proxyuser.${FUSION_USER}.hosts</code> property already exists with predefined hostnames, please append <code>fusion-server-hdp</code> to the value (comma-delimited).</p><p><em>Example -</em> <code>hadoop.proxyuser.hdfs.hosts=hdp_namenode01,hdp_namenode02,fusion-server-hdp</code></p><p>If this property value is a wildcard (<code>*</code>), then it does not need to changed.</p><p><strong>Save</strong> the HDFS config once all additions have been made.</p></li><li><p><strong>Restart the cluster services.</strong></p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configure-fusion"></a>Configure Fusion<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configure-fusion" title="Direct link to heading">#</a></h3><ol><li><p>Log in to the Docker host via terminal, edit the <code>ui.properties</code> file on the Fusion UI container in the HDP zone.</p><p><code>root@&lt;DOCKER_HOST&gt;:~# docker exec -it fusion_fusion-ui-server-hdp_1 bash</code></p><p><code>[hdfs@&lt;FUSION_UI_HDP&gt; /]$ vi /opt/wandisco/fusion-ui-server/properties/ui.properties</code></p><p>Add the following properties below, but adjust the values (prefixed with <code>$</code>) so that they are correct for your environment:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cluster.kerberos.configured=</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kerberos.enabled=</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kerberos.config.path=/etc/krb</span><span class="token number" style="color:rgb(247, 140, 108)">5.</span><span class="token plain">conf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kerberos.principal=$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">FUSION_PRINCIPAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">@$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">REALM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kerberos.keytab.path=/etc/security/keytabs/$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">FUSION_KEYTAB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">.keytab</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kerberos.generated.config.path=/opt/wandisco/fusion-ui-server/lib/kerberos.conf</span></div></div></div></div></div><p>Once complete, save and quit the file. Exit the container once complete.</p><p><code>exit</code></p></li></ol><ol start="2"><li><p>Adjust the ownership of required files inside of one of the Fusion containers in the HDP zone.</p><p><code>root@&lt;DOCKER_HOST&gt;:~# docker exec -u root -it fusion_fusion-server-hdp_1 bash -c &#x27;chown hdfs:hdfs /etc/security/keytabs/hdfs.headless.keytab /etc/hadoop/conf/core-site.xml /etc/hadoop/conf/hdfs-site.xml&#x27;</code></p></li><li><p>Restart the Fusion containers in the HDP zone (except SSHD) so that the configuration is picked up by Fusion. You must be inside the <code>fusion-docker-compose</code> directory to run this command.</p><p><code>root@&lt;DOCKER_HOST&gt;:~/fusion-docker-compose# docker-compose restart fusion-ihc-server-hdp fusion-server-hdp fusion-ui-server-hdp fusion-nn-proxy-hdp</code></p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="troubleshooting"></a>Troubleshooting<a aria-hidden="true" tabindex="-1" class="hash-link" href="#troubleshooting" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="starting-the-ambari-agent"></a>Starting the Ambari Agent<a aria-hidden="true" tabindex="-1" class="hash-link" href="#starting-the-ambari-agent" title="Direct link to heading">#</a></h3><p>When restarting the SSHD container (or all containers), the <code>ambari-agent</code> service will not be started automatically.</p><p>To start it, log in to the Docker host and run the command below:</p><p><code>docker exec -it fusion_sshd-hdp_1 bash -c &#x27;ambari-agent start&#x27;</code></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#integrating-kerberos-with-fusion" class="table-of-contents__link">Integrating Kerberos with Fusion</a><ul><li><a href="#add-the-sshd-container-to-the-hdp-cluster" class="table-of-contents__link">Add the SSHD container to the HDP cluster</a></li><li><a href="#configure-the-hdp-cluster" class="table-of-contents__link">Configure the HDP cluster</a></li><li><a href="#configure-fusion" class="table-of-contents__link">Configure Fusion</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link">Troubleshooting</a><ul><li><a href="#starting-the-ambari-agent" class="table-of-contents__link">Starting the Ambari Agent</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/wandisco-documentation/docs/quickstarts/installation/quickstart-config">Getting Started</a></li><li class="footer__item"><a href="https://docs.wandisco.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Product User Guides</a></li><li class="footer__item"><a href="https://community.wandisco.com/s/knowledge-base" target="_blank" rel="noopener noreferrer" class="footer__link-item">Knowledge Base</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://community.wandisco.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">WANdisco Community</a></li><li class="footer__item"><a href="//wandisco.com/partners" target="_blank" rel="noopener noreferrer" class="footer__link-item">Partners</a></li><li class="footer__item"><a href="//twitter.com/WANdisco" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/wandisco-documentation/docs/help/need_help">Help</a></li><li class="footer__item"><a href="https://wandisco.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://blogs.wandisco.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Blog</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 WANdisco, Inc.</div></div></div></footer></div>
<script src="/wandisco-documentation/styles.6c749758.js"></script>
<script src="/wandisco-documentation/runtime~main.f21f7e0f.js"></script>
<script src="/wandisco-documentation/main.a3cad2da.js"></script>
<script src="/wandisco-documentation/1.2d25f03f.js"></script>
<script src="/wandisco-documentation/2.b83af041.js"></script>
<script src="/wandisco-documentation/3.73e74ddd.js"></script>
<script src="/wandisco-documentation/1be78505.a01211c2.js"></script>
<script src="/wandisco-documentation/113.cffd459e.js"></script>
<script src="/wandisco-documentation/ae4b7282.81cbb644.js"></script>
<script src="/wandisco-documentation/17896441.acb2b8c3.js"></script>
<script src="/wandisco-documentation/d6a58866.b677835f.js"></script>
</body>
</html>